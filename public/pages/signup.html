<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - Trackle</title>
    <link href="./css/output.css" rel="stylesheet" />
    <script
      src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"
      integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz"
      crossorigin="anonymous"
    ></script>
  </head>
  <body class="bg-background min-h-screen">
    <div class="min-h-screen w-full bg-transparent fixed z-[-1]">
      <div
        class="absolute inset-0 z-0"
        style="
          background: #000000;
          background-image:
            radial-gradient(
              circle at 1px 1px,
              rgba(139, 92, 246, 0.2) 1px,
              transparent 0
            ),
            radial-gradient(
              circle at 1px 1px,
              rgba(59, 130, 246, 0.18) 1px,
              transparent 0
            ),
            radial-gradient(
              circle at 1px 1px,
              rgba(236, 72, 153, 0.15) 1px,
              transparent 0
            );
          background-size:
            20px 20px,
            30px 30px,
            25px 25px;
          background-position:
            0 0,
            10px 10px,
            15px 5px;
        "
      ></div>
    </div>

    <main class="relative z-10">
      <nav class="bg-transparent">
        <div class="container mx-auto px-6 lg:px-8 py-8">
          <div class="flex justify-between items-center">
            <a href="/" class="text-2xl sm:text-4xl font-bold text-heading"
              >Trackle</a
            >
            <div class="flex items-center gap-1.5 sm:gap-3">
              <div class="w-fit">
                <a
                  href="/login.html"
                  class="max-sm:text-sm relative flex items-center w-full overflow-hidden px-4 sm:px-6 py-1.5 sm:py-2.5 rounded-full text-white font-bold bg-transparent outline outline-white"
                >
                  Log In
                </a>
              </div>
              <div class="w-fit">
                <a
                  href="/signup.html"
                  class="max-sm:text-sm relative flex items-center w-full overflow-hidden px-4 sm:px-6 py-1.5 sm:py-2.5 rounded-full text-white font-bold bg-accent outline outline-accent"
                >
                  Sign Up
                </a>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <div class="container mx-auto px-4 py-16">
        <div
          class="max-w-md mx-auto bg-transparent rounded-xl border border-white/30 p-8 card-gradient"
        >
          <h2 class="text-3xl font-bold text-gray-900 mb-2 text-center">
            Create Account
          </h2>
          <p class="text-center mb-8">
            Start tracking your subscriptions today
          </p>

          <div
            id="error-message"
            class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4"
          ></div>

          <form id="signup-form" class="space-y-6">
            <div>
              <label
                for="name"
                class="block text-sm font-medium text-white/50 mb-2"
                >Full Name</label
              >
              <input
                type="text"
                id="name"
                name="name"
                required
                minlength="2"
                maxlength="50"
                class="w-full px-4 py-3 border border-white/20 rounded-lg focus:outline-none focus:border-secondary placeholder:text-white/50 text-white/80"
                placeholder="John Doe"
              />
            </div>

            <div>
              <label
                for="email"
                class="block text-sm font-medium text-white/50 mb-2"
                >Email</label
              >
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 border border-white/20 rounded-lg focus:outline-none focus:border-secondary placeholder:text-white/50 text-white/80"
                placeholder="you@example.com"
              />
            </div>

            <div>
              <label
                for="password"
                class="block text-sm font-medium text-white/50 mb-2"
                >Password</label
              >
              <input
                type="password"
                id="password"
                name="password"
                required
                minlength="6"
                class="w-full px-4 py-3 border border-white/20 rounded-lg focus:outline-none focus:border-secondary placeholder:text-white/50 text-white/80"
                placeholder="••••••••"
              />
              <p class="text-sm text-white/50 mt-1">At least 6 characters</p>
            </div>

            <button
              type="submit"
              id="submit-btn"
              class="relative flex items-center justify-center w-full overflow-hidden px-6 py-2.5 rounded-full text-white font-bold bg-accent outline outline-accent"
            >
              Create Account
            </button>
          </form>

          <p class="text-center text-gray-600 mt-6">
            Already have an account?
            <a
              href="/login.html"
              class="text-secondary hover:text-secondary font-semibold underline"
              >Sign in</a
            >
          </p>
        </div>
      </div>
    </main>
    <script>
      // Keep signup client-side to store token & user in localStorage (no server cookie)
      const form = document.getElementById("signup-form");
      const errorDiv = document.getElementById("error-message");
      const submitBtn = document.getElementById("submit-btn");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        errorDiv.classList.add("hidden");
        submitBtn.disabled = true;
        submitBtn.textContent = "Creating account...";

        try {
          const response = await fetch("/api/v1/auth/sign-up", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, password }),
          });

          const data = await response.json();
          if (response.ok && data.success) {
            localStorage.setItem("token", data.data.token);
            localStorage.setItem("user", JSON.stringify(data.data.user));
            window.location.href = "/dashboard.html";
          } else {
            errorDiv.textContent =
              data.message || "Sign up failed. Please try again.";
            errorDiv.classList.remove("hidden");
            submitBtn.disabled = false;
            submitBtn.textContent = "Create Account";
          }
        } catch (err) {
          errorDiv.textContent = "An error occurred. Please try again.";
          errorDiv.classList.remove("hidden");
          submitBtn.disabled = false;
          submitBtn.textContent = "Create Account";
        }
      });
    </script>
  </body>
</html>
